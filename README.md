# PID调参工具使用说明 (增强版 - 支持UV)

## 安装依赖

### 方法1：使用UV（推荐）
```bash
# 安装uv（如果还没有安装）
pip install uv

# 安装项目依赖
uv sync

# 或者从GitHub/其他源安装
uv pip install -e .
```

### 方法2：使用传统pip
```bash
pip install -r requirements.txt
```

## 运行工具

### 使用UV（推荐）
```bash
# 运行PID调参工具
uv run pid-tuner

# 运行测试接收器
uv run pid-receiver

# 或者直接运行Python文件
uv run python pid_tuner.py
uv run python test_receiver.py
```

### 使用传统方式
```bash
python pid_tuner.py
python test_receiver.py
```

## UV的优势

- 🚀 **极快的安装速度**：比pip快10-100倍
- 🔒 **可靠的依赖管理**：自动解决版本冲突
- 🛠️ **现代化工具链**：统一的项目管理体验
- 📦 **内置虚拟环境**：无需手动管理venv

详细的UV使用指南请参考：[UV_GUIDE.md](UV_GUIDE.md)

## 工具介绍

本工具包含以下文件：
- `pid_tuner.py` - 主要的PID调参GUI工具（增强版）
- `test_receiver.py` - 串口数据接收测试工具
- `protocol_doc.md` - 通信协议详细文档
- `pyproject.toml` - 项目配置文件（UV/pip兼容）
- `requirements.txt` - Python依赖列表（向后兼容）
- `UV_GUIDE.md` - UV包管理器详细使用指南

## 新增功能特性

### 🎯 自定义参数范围
- 每个PID参数都可以自定义最小值和最大值
- 实时更新滑块范围，精确控制参数调节
- 范围设置会自动保存到配置文件

### 🎛️ 增强的滑块控制
- 高精度滑块，支持小数点后6位精度
- 精度调节按钮（+/-按钮），可以进行0.001的微调
- 实时数值显示和输入框同步

### 📊 分页式界面
- **PID参数调节页面**：专注于参数调节操作
- **参数范围设置页面**：独立的范围配置界面

### 🔧 增强的功能按钮
- **推荐值**：一键设置每个环路的推荐起始参数
- **清零**：快速清零某个环路的所有参数
- **导出报告**：生成详细的参数调试报告

### 📦 现代化包管理
- 支持UV和pip两种包管理器
- 提供项目脚本命令，可直接运行
- 完整的开发环境配置

## 快速开始

### 1. 安装和运行
```bash
# 使用UV（推荐）
uv sync
uv run pid-tuner

# 或使用pip
pip install -r requirements.txt
python pid_tuner.py
```

### 2. 连接串口
- 在"串口设置"区域选择正确的COM端口
- 选择波特率（推荐115200）
- 点击"连接"按钮
- 观察连接状态指示灯（绿色=已连接，红色=未连接）

### 3. 设置参数范围（可选但推荐）
- 切换到"参数范围设置"页面
- 为每个参数设置合适的最小值和最大值
- 点击"应用"按钮更新滑块范围

**推荐范围设置：**
```
角速度环:
  P: 0.0 - 50.0 (可根据实际需要调整上限)
  I: 0.0 - 5.0
  D: 0.0 - 2.0

角度环:
  P: 0.0 - 20.0
  I: 0.0 - 2.0
  D: 0.0 - 1.0

速度环:
  P: 0.0 - 30.0
  I: 0.0 - 3.0
  D: 0.0 - 1.5
```

### 4. 调整PID参数
切换到"PID参数调节"页面：

#### 方法1：使用滑块
- 拖动滑块调节参数值
- 滑块会根据你设置的范围自动调整

#### 方法2：直接输入数值
- 在参数输入框中直接输入精确数值
- 支持小数点后6位精度

#### 方法3：精度微调
- 使用参数旁边的+/-按钮进行0.001的精细调节
- 适合最后的精细调参

#### 方法4：使用预设值
- 点击"推荐值"按钮快速设置起始参数
- 点击"清零"按钮快速清空参数

### 5. 参数发送和测试
- **单独发送**：点击每个环路的"发送"按钮
- **全部发送**：点击底部的"发送所有参数"按钮
- **实时观察**：通过状态信息查看发送日志

### 6. 配置管理
- **保存配置**：保存当前参数值和范围设置
- **加载配置**：从文件恢复之前的设置
- **导出报告**：生成详细的调参报告文档

## 开发环境设置

### 使用UV
```bash
# 安装开发依赖
uv sync --all-extras

# 代码格式化
uv run black .

# 代码检查
uv run flake8 .

# 类型检查
uv run mypy .
```

### 添加新依赖
```bash
# 添加运行时依赖
uv add package-name

# 添加开发依赖
uv add --dev package-name
```

## 调参策略和技巧

### 🎯 推荐调参顺序
1. **第一步**：设置合适的参数范围
2. **第二步**：从角速度环开始调参
3. **第三步**：调节角度环
4. **第四步**：最后调节速度环

### 🔧 使用技巧

#### 快速开始
1. 点击"推荐值"设置起始参数
2. 发送参数观察效果
3. 根据响应情况微调

#### 精细调参
1. 使用滑块进行粗调
2. 使用输入框进行精确设置
3. 使用+/-按钮进行最终微调

#### 范围设置技巧
- 根据你的系统特性设置合适的范围
- P参数范围可以设置较大，方便快速找到合适区间
- I和D参数范围通常较小，避免系统不稳定

### 📊 参数效果分析
- **P参数过大**：系统震荡，响应过激
- **P参数过小**：响应迟缓，跟踪性能差
- **I参数过大**：超调严重，可能不稳定
- **I参数过小**：稳态误差大
- **D参数过大**：噪声放大，高频震荡
- **D参数过小**：超调，动态性能差

## 界面说明

### PID参数调节页面
- **参数标签**：显示P、I、D参数名称
- **范围显示**：显示当前参数的调节范围
- **滑块控制**：拖动调节参数值
- **数值输入**：精确输入参数值
- **精度调节**：+/-按钮进行微调
- **功能按钮**：发送、推荐值、清零

### 参数范围设置页面
- **最小值设置**：设置参数下限
- **最大值设置**：设置参数上限
- **应用按钮**：应用单个参数范围
- **应用全部**：应用整个环路的范围设置

## 导出报告功能

点击"导出参数报告"会生成包含以下信息的文档：
- 当前所有PID参数值
- 每个参数的调节范围
- 生成时间戳
- 便于记录和分析调参过程

## 故障排除

### 滑块不响应
- 检查参数范围设置是否合理
- 确保最小值小于最大值
- 重新应用范围设置

### 精度调节问题
- 精度调节步长为0.001
- 如果需要更大步长，可以直接在输入框修改

### 界面显示问题
- 调整窗口大小到1200x800或更大
- 使用滚动条查看完整内容

### UV相关问题
- 如果UV命令不工作，检查是否正确安装：`uv --version`
- 如果依赖安装失败，尝试：`uv sync --reinstall`
- 查看详细的UV使用指南：[UV_GUIDE.md](UV_GUIDE.md)

## 技术支持

如需技术支持，请提供：
1. 错误现象描述
2. 使用的参数值和范围设置
3. 串口配置信息
4. 状态信息区域的错误日志
5. 导出的参数报告（如有）
6. 使用的包管理器（UV或pip）和版本信息