# PID调参工具通信协议文档

## 协议概述
本协议用于通过串口传输PID参数到底盘控制系统，支持三种控制环路的参数调节。

## 数据帧格式
```
+--------+--------+--------+--------+--------+----------+
| 帧头   | 指令字 |   P    |   I    |   D    |  校验和  |
+--------+--------+--------+--------+--------+----------+
| 0xA5   | 1字节  | 4字节  | 4字节  | 4字节  |  1字节   |
+--------+--------+--------+--------+--------+----------+
```

总长度：17字节

## 字段说明

### 1. 帧头 (1字节)
- 固定值：0xA5
- 用于帧同步和数据包识别

### 2. 指令字 (1字节)
- 0x05: 角速度环PID参数
- 0x06: 角度环PID参数  
- 0x07: 速度环PID参数

### 3. PID参数 (12字节)
- P参数：4字节IEEE754单精度浮点数，小端序
- I参数：4字节IEEE754单精度浮点数，小端序
- D参数：4字节IEEE754单精度浮点数，小端序

### 4. 校验和 (1字节)
- 计算方法：(指令字 + P的4字节 + I的4字节 + D的4字节) 的和 & 0xFF

## 参数范围建议

### 角速度环
- P: 0.1 ~ 50.0 (推荐起始值: 10.0)
- I: 0.0 ~ 5.0  (推荐起始值: 0.1)
- D: 0.0 ~ 2.0  (推荐起始值: 0.01)

### 角度环  
- P: 0.1 ~ 20.0 (推荐起始值: 5.0)
- I: 0.0 ~ 2.0  (推荐起始值: 0.05)
- D: 0.0 ~ 1.0  (推荐起始值: 0.1)

### 速度环
- P: 0.1 ~ 30.0 (推荐起始值: 8.0)
- I: 0.0 ~ 3.0  (推荐起始值: 0.2)
- D: 0.0 ~ 1.5  (推荐起始值: 0.05)

## 使用流程

1. 连接串口（推荐115200波特率）
2. 在界面上调整PID参数
3. 点击"发送"按钮发送单个环路参数
4. 或点击"发送所有参数"一次性发送所有参数
5. 观察底盘响应效果
6. 根据效果调整参数并重新发送

## 调参建议

### 调参顺序
1. 首先调节角速度环（内环）
2. 然后调节角度环（外环）
3. 最后调节速度环

### 调参方法
1. **P参数调节**：从小到大逐步增加，直到系统响应足够快但不震荡
2. **I参数调节**：用于消除稳态误差，过大会导致超调和震荡
3. **D参数调节**：用于改善动态性能，减少超调，但过大会放大噪声

### 现象分析
- **震荡**: P过大或D过小
- **响应慢**: P过小
- **稳态误差**: I过小
- **超调大**: I过大或D过小
- **噪声大**: D过大

## 数据包示例

发送角速度环参数 P=10.0, I=0.1, D=0.01：
```
A5 01 00 00 20 41 CD CC CC 3D 0A D7 A3 3C 42
```

解析：
- A5: 帧头
- 01: 角速度环指令字
- 00 00 20 41: P=10.0 (IEEE754)
- CD CC CC 3D: I=0.1 (IEEE754)  
- 0A D7 A3 3C: D=0.01 (IEEE754)
- 42: 校验和

## 协议优势

### 简化设计
- 去除了帧尾，减少数据包长度
- 单字节帧头，更容易识别
- 简洁的17字节数据包

### 可靠性
- 校验和验证确保数据完整性
- 指令字范围检查防止错误解析
- 固定长度便于解析和缓冲区管理

### 易于实现
- 结构简单，适合单片机环境
- 无需复杂的状态机解析
- 支持中断和轮询两种接收方式